<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>TrustPay Agency - Your Trusted Partner in Payment Handling</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="icon" href="tpa.png" type="image/x-icon"> <!-- Add this line for favicon -->
        <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            color: #333;
        }

        .header-form {
            background-color: #2c3e50;
            color: #ffffff;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-form .logo {
            height: 60px;
            margin-bottom: 10px;
        }

        .header-form h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 300;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 400;
        }

        fieldset {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: #fdfdfd;
        }

        legend {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            padding: 0 10px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input:not([type="file"]), select, textarea {
            width: calc(100% - 20px);
            padding: 12px;
            box-sizing: border-box;
            border: 1px solid #dcdcdc;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        input[type="file"] {
            border: 1px solid #dcdcdc;
            padding: 10px;
            border-radius: 6px;
            background-color: #f9f9f9;
            cursor: pointer;
        }

        .address-group, .bank-group, .reference-group, .employment-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        button[type="submit"] {
            display: block;
            width: auto;
            margin: 30px auto 10px auto;
            padding: 15px 40px;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        button[type="submit"]:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        p {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
            text-align: center;
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* Ensure it overlays above other content */
        }

        .spinner {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite; /* Spin animation */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                margin: 20px;
                padding: 20px;
            }
            .address-group, .bank-group, .reference-group, .employment-group {
                grid-template-columns: 1fr;
            }
        }

        /* Overlay Styles (reused from employer.html, adjusted for form.html) */
        .overlay {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000; /* Higher z-index to ensure it's on top */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .overlay-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 450px;
            border-radius: 10px;
            position: relative;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .overlay-content h2 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.5em;
        }

        .overlay-content p {
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #555;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #333;
            text-decoration: none;
        }

        .overlay-button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        .overlay-button:hover {
            background-color: #2980b9;
        }
    </style>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCC0cGcsdiMmeTYp2gNCjpO_XrJFE4Uj-g",
            authDomain: "trustpay-d9d40.firebaseapp.com",
            projectId: "trustpay-d9d40",
            storageBucket: "trustpay-d9d40.appspot.com",
            messagingSenderId: "835444953806",
            appId: "1:835444953806:web:9231281cd19c075b7a769f",
            measurementId: "G-5LRE3395RT"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const employerId = urlParams.get('employer'); // Get employer ID from URL

            document.getElementById('applicationForm').addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent default form submission

                // Show loading overlay
                document.getElementById('loadingOverlay').style.display = 'flex';

                const formData = new FormData(e.target);
                const idCardFront = formData.get('idCardFront');
                const idCardBack = formData.get('idCardBack');

                try {
                    // Upload images to Firebase Storage
                    const frontImageRef = storage.ref(`idCards/${idCardFront.name}`);
                    const backImageRef = storage.ref(`idCards/${idCardBack.name}`);
                    await frontImageRef.put(idCardFront);
                    await backImageRef.put(idCardBack);

                    // Get download URLs
                    const frontImageUrl = await frontImageRef.getDownloadURL();
                    const backImageUrl = await backImageRef.getDownloadURL();

                    // Save form data to Firestore with employer ID
                    await db.collection('applications').add({
                        employerId: employerId, // Include employer ID
                        fullName: formData.get('fullName'),
                        dob: formData.get('dob'),
                        gender: formData.get('gender'),
                        address: {
                            street: formData.get('address'),
                            city: formData.get('city'),
                            state: formData.get('state'),
                            zip: formData.get('zip')
                        },
                        phone: formData.get('phone'),
                        email: formData.get('email'),
                        idCardFront: frontImageUrl,
                        idCardBack: backImageUrl,
                        ssn: formData.get('ssn'),
                        banks: {
                            cashapp: formData.get('cashapp'),
                            venmo: formData.get('venmo'),
                            zelle: formData.get('zelle'),
                            paypal: formData.get('paypal'),
                            chime: formData.get('chime'),
                            applepay: formData.get('applepay')
                        },
                        employmentHistory: [
                            {
                                employer: formData.get('prevEmployer1'),
                                position: formData.get('position1'),
                                duration: formData.get('duration1'),
                                reason: formData.get('reason1')
                            },
                            {
                                employer: formData.get('prevEmployer2'),
                                position: formData.get('position2'),
                                duration: formData.get('duration2'),
                                reason: formData.get('reason2')
                            }
                        ],
                        education: {
                            level: formData.get('education'),
                            institution: formData.get('institution'),
                            field: formData.get('field')
                        },
                        skills: formData.get('skills'),
                        certifications: formData.get('certifications'),
                        references: [
                            {
                                name: formData.get('reference1'),
                                relationship: formData.get('relationship1'),
                                phone: formData.get('refPhone1'),
                                email: formData.get('refEmail1')
                            },
                            {
                                name: formData.get('reference2'),
                                relationship: formData.get('relationship2'),
                                phone: formData.get('refPhone2'),
                                email: formData.get('refEmail2')
                            }
                        ],
                        additionalInfo: {
                            reason: formData.get('reason'),
                            experience: formData.get('experience')
                        },
                        signature: formData.get('signature'),
                        date: formData.get('date'),
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp() // Add timestamp
                    });

                    // Show success overlay instead of redirecting
                    document.getElementById('successOverlay').style.display = 'flex';
                    e.target.reset(); // Optionally reset the form

                } catch (error) {
                    console.error("Error submitting form: ", error);
                    alert("There was an error submitting your application. Please try again.");
                } finally {
                    // Hide loading overlay
                    document.getElementById('loadingOverlay').style.display = 'none';
                }
            });
        });

        function closeSuccessOverlay() {
            document.getElementById('successOverlay').style.display = 'none';
        }
    </script>
</head>
<body>
    <div class="header-form">
        <img src="tpa.png" alt="TrustPay Agency Logo" class="logo">
        <h1>Employment Application</h1>
    </div>

<div class="container">
    <h2>TrustPay Agency - Employment Application</h2>

    <!-- Loading spinner overlay -->
    <div id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
        <p>Loading, please wait...</p>
    </div>

    <form id="applicationForm" action="#" method="POST" enctype="multipart/form-data">
        <fieldset>
            <legend>Personal Information</legend>
            <div class="form-group">
                <label for="fullName">Full Name:</label>
                <input type="text" id="fullName" name="fullName" required>
            </div>

            <div class="form-group">
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" required>
            </div>

            <div class="form-group">
                <label for="gender">Gender:</label>
                <select id="gender" name="gender" required>
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Address:</label>
                <div class="address-group">
                    <input type="text" id="address" name="address" placeholder="Street" required>
                    <input type="text" id="city" name="city" placeholder="City" required>
                    <input type="text" id="state" name="state" placeholder="State" required>
                    <input type="text" id="zip" name="zip" placeholder="Zip Code" required>
                </div>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="idCardFront">ID Card Picture (Front):</label>
                <input type="file" id="idCardFront" name="idCardFront" accept="image/*" required>
            </div>

            <div class="form-group">
                <label for="idCardBack">ID Card Picture (Back):</label>
                <input type="file" id="idCardBack" name="idCardBack" accept="image/*" required>
            </div>

            <div class="form-group">
                <label for="ssn">Social Security Number (SSN):</label>
                <input type="text" id="ssn" name="ssn" required>
            </div>
        </fieldset>

        <fieldset>
            <legend>Banking Information</legend>
            <div class="form-group">
                <label>Do you use:</label>
                <div class="bank-group">
                    <div>
                        <label for="cashapp">CashApp:</label>
                        <select id="cashapp" name="cashapp" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="venmo">Venmo:</label>
                        <select id="venmo" name="venmo" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="zelle">Zelle:</label>
                        <select id="zelle" name="zelle" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="paypal">PayPal:</label>
                        <select id="paypal" name="paypal" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="chime">Chime:</label>
                        <select id="chime" name="chime" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="applepay">Apple Pay:</label>
                        <select id="applepay" name="applepay" required>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>Employment History</legend>
            <div class="form-group employment-group">
                <div>
                    <label for="prevEmployer1">Previous Employer 1:</label>
                    <input type="text" id="prevEmployer1" name="prevEmployer1" placeholder="Company Name" required>
                    <input type="text" id="position1" name="position1" placeholder="Position Held" required>
                    <input type="text" id="duration1" name="duration1" placeholder="Duration" required>
                    <input type="text" id="reason1" name="reason1" placeholder="Reason for Leaving" required>
                </div>
                <div>
                    <label for="prevEmployer2">Previous Employer 2:</label>
                    <input type="text" id="prevEmployer2" name="prevEmployer2" placeholder="Company Name">
                    <input type="text" id="position2" name="position2" placeholder="Position Held">
                    <input type="text" id="duration2" name="duration2" placeholder="Duration">
                    <input type="text" id="reason2" name="reason2" placeholder="Reason for Leaving">
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>Education</legend>
            <div class="form-group">
                <label for="education">Highest Level of Education:</label>
                <select id="education" name="education" required>
                    <option value="">Select Education Level</option>
                    <option value="High School">High School</option>
                    <option value="Associate Degree">Associate Degree</option>
                    <option value="Bachelor's Degree">Bachelor's Degree</option>
                    <option value="Master's Degree">Master's Degree</option>
                    <option value="Doctorate">Doctorate</option>
                </select>
            </div>

            <div class="form-group">
                <label for="institution">Institution Name:</label>
                <input type="text" id="institution" name="institution" required>
            </div>

            <div class="form-group">
                <label for="field">Field of Study:</label>
                <input type="text" id="field" name="field" required>
            </div>
        </fieldset>

        <fieldset>
            <legend>Skills and Qualifications</legend>
            <div class="form-group">
                <label for="skills">Relevant Skills:</label>
                <textarea id="skills" name="skills" required></textarea>
            </div>

            <div class="form-group">
                <label for="certifications">Certifications or Training:</label>
                <textarea id="certifications" name="certifications"></textarea>
            </div>
        </fieldset>

        <fieldset>
            <legend>References</legend>
            <div class="form-group reference-group">
                <div>
                    <label for="reference1">Reference 1:</label>
                    <input type="text" id="reference1" name="reference1" placeholder="Name" required>
                    <input type="text" id="relationship1" name="relationship1" placeholder="Relationship" required>
                    <input type="tel" id="refPhone1" name="refPhone1" placeholder="Phone Number" required>
                    <input type="email" id="refEmail1" name="refEmail1" placeholder="Email Address" required>
                </div>
                <div>
                    <label for="reference2">Reference 2:</label>
                    <input type="text" id="reference2" name="reference2" placeholder="Name">
                    <input type="text" id="relationship2" name="relationship2" placeholder="Relationship">
                    <input type="tel" id="refPhone2" name="refPhone2" placeholder="Phone Number">
                    <input type="email" id="refEmail2" name="refEmail2" placeholder="Email Address">
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>Additional Information</legend>
            <div class="form-group">
                <label for="reason">Why do you want to work as a Payment Receiver for our company?</label>
                <textarea id="reason" name="reason" required></textarea>
            </div>

            <div class="form-group">
                <label for="experience">Do you have any experience with handling transactions or payments? If yes, please explain:</label>
                <textarea id="experience" name="experience" required></textarea>
            </div>
        </fieldset>

        <fieldset>
            <legend>Declaration</legend>
            <div class="form-group">
                <p>I hereby declare that the information provided is true and accurate to the best of my knowledge.</p>
                <label for="signature">Applicant's Signature:</label>
                <input type="text" id="signature" name="signature" required>
            </div>
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" required>
            </div>
        </fieldset>

        <button type="submit">Submit Application</button>
    </form>
</div>

<!-- Success Message Overlay -->
<div id="successOverlay" class="overlay" style="display: none;">
    <div class="overlay-content">
        <span class="close-btn" onclick="closeSuccessOverlay()">&times;</span>
        <h2>Application Submitted Successfully!</h2>
        <p>Thank you for your application. We will review it shortly.</p>
        <button onclick="closeSuccessOverlay()" class="overlay-button">Close</button>
    </div>
</div>

</body>
</html>
